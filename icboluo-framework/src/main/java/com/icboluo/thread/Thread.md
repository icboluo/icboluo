## sleep

Thread.sleep(0) 的作用：告诉cpu，我吃饱了，暂时不参与竞争\
在一个大的循环体中，放一个这个可以释放cpu资源，让其他的线程再进行竞争（界面不会出现卡死

# 锁

## 公平锁

多个线程按照申请顺序来获取锁

## 非公平锁

随便加进去

## 可重入锁

调用子函数不会死锁

## 多线程

每一个请求都会使用一个线程，tomcat会维护一个线程池，每个http请求会在tomcat中取一个空闲的线程

多线程中有任务调度的时间，单核cpu的效率是下降的，内核级别的多线程（多核cpu）效率会提升

## async

async必须交给spring，不能自己new

自己类调用自己是没有效果的

then apply 前后是同一个线程执行（。。。

async同类调用没有效果：用的是aop，aop用的是动态代理；动态代理针对的是方法级别，方法内部调用本类的方法，是不会使用到代理类的

## mdc

mdc使用的是 thread local，可以当做thread local使用，异步线程之间通信可以使用mdc和thread local，mdc支持日志的追踪定位等功能

## thread local

thread local相当于一个线程的一个全局变量

thread local不是解决对象共享访问问题的，主要是提供了保持对象的方法和 避免参数传递 的方便的对象访问方式

thread local和@async 前面的代表本地线程，后面代表异步线程，数据不能共享，可以用线程池、代理增强等方式处理

## sleep wait

sleep和wait均针对于锁，他们的不同和线程无关，均不会释放线程

## volition

防止指令重排

## 效率

异步追求效率的过程中，cf比join要好很多，cf能更小颗粒度的控制流程
